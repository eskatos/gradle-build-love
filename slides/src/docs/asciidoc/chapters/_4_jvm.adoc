[background-color="#02303a"]
== Fonctionnalités JVM
image::gradle/bg-6.png[background, size=cover]

&#x2615;

=== Fonctionnalités JVM
image::gradle/bg-6.png[background, size=cover]

```
* Utiliser un gradle init application comme base (included-build plutôt que buildSrc? à ajouter)
* Version catalog (support dans Gradle init à ajouter!)
* Toolchains
* Testing
** Matrix testing?
** Aggregation
* Dependency verification
* Test fixtures / feature variants
* Publishing
```

=== Catalogue de versions
image::gradle/bg-6.png[background, size=cover]

[%step]
* Centralisation de la liste des dépendances
[%step]
** Leurs coordonnées et version, y compris riche
** Pas de classifier, exclude ou autres attributs
* Fourni des accesseurs typés
* Possibilité de séparer la version du `group:artifact`
* Permet de déclarer des groupes de dépendances

[background-color="#02303a"]
=== Démo
image::gradle/bg-6.png[background, size=cover]

=== Format TOML
image::gradle/bg-6.png[background, size=cover]

[source,toml]
----
[versions]
groovy = "4.0.1"
lang = { strictly = "[3.8, 4.0[", prefer="3.9" } }

[libraries]
groovy-core = { module = "org.apache.groovy:groovy", version.ref = "groovy" }
groovy-json = { module = "org.apache.groovy:groovy-json", version.ref = "groovy" }
commons-lang3 = { group = "org.apache.commons", name = "commons-lang3", version.ref = "lang" }

[bundles]
groovy = ["groovy-core", "groovy-json", "groovy-nio"]

[plugins]
logging-capabilities = { id = "dev.jacomet.logging-capabilities", version = "0.10.0" }
----

Il existe aussi une API dans le fichier `settings` de Gradle.

=== Points d'attention
image::gradle/bg-6.png[background, size=cover]

* Participe à la résolution de dépendances de façon classique
** N'impose pas une version
* Possibilité de publier et donc d'importer un catalogue
* Pas accessible pour un plugin de settings ou un scrip d'initialisation

=== Java Toolchains
image::gradle/bg-6.png[background, size=cover]

[%step]
* Permet de séparer le Java qui tourne Gradle de celui requis par le projet
* Application pour la compilation, les tests et l'exécution
* Permet de choisir avec les critères de :
[%step]
** Version du langage Java
** Vendeur de la JVM
** (Implémentation: défaut ou J9)

[background-color="#02303a"]
=== Démo
image::gradle/bg-6.png[background, size=cover]

=== Quel Java Gradle connait-il?
image::gradle/bg-6.png[background, size=cover]

* Un certain nombre de défaut
[%step]
** Défauts par OS: Linux, macOS, Windows
** Package managers: Asdf-vm, Jabba, SDKMAN!
** Maven toolchains
** Téléchargements précédents

=== Provisioner Java
image::gradle/bg-6.png[background, size=cover]

[%step]
* Possible grâce à AdoptOpenJDK
* Mais pas idéal, suite à la migration Adoptium
* Micmac avec le vendeur

=== Futur
image::gradle/bg-6.png[background, size=cover]

[%step]
* SPI pour créer des plugins de provisionement
* Plus d'options pour sélectionner sa JVM
** GraalVM, version plus précise, early access, ...
* Plus de tâches qui les supportent
** Dans Gradle: analyse de code par exemple
** Dans les plugins de la communauté, demandez le support!

=== Les suites de tests
image::gradle/bg-6.png[background, size=cover]

[%step]
* Modélise une collection de tests
* Abstrait la configuration du `SourceSet`, des `Configurations` et de la tâche de `Test`
* Permet une séparation logique des tests au niveau des sources et dépendances
* Le `test` par défaut de Gradle est maintenant dérivé de ce modèle

[background-color="#02303a"]
=== Démo
image::gradle/bg-6.png[background, size=cover]

=== Evolution des suites de tests
image::gradle/bg-6.png[background, size=cover]

* Possibilité d'avoir plusieurs dimensions
** Différentes versions de Java pour tourner les tests
** Se traduira par plusieurs tâches de `Test`
* Intégration avec la couverture de code
** Nécessite d'interagir avec la tâche

=== Test fixtures
image::gradle/bg-6.png[background, size=cover]

* Permet de séparer les fixtures du code de test
* Permet de consommer les fixtures d'une librairie
* Illustration du modèle avancé de gestion de dépendances de Gradle

[background-color="#02303a"]
=== Démo
image::gradle/bg-8.png[background, size=cover]

=== Modélisation des tests fixtures

* Comme les suites de test: sources et dépendances séparées
* Publiées de façon complètes
** Comme une variante dans Gradle Module Metadata
** Avec un `classifier` pour utilisation dans Maven / Ivy
* Exemple de cette notion de variante dans la gestion de dépendances

=== Gestion de dépendances: les variantes

* Dimension supplémentaire d'un composant logiciel
* Peut avoir ses propres artifacts et dépendances
* Pensez `classifier`, sans les limitations
* Nécessite Gradle Module Metadata

=== Autre exemple: Dépendances optionelles

[%step]
* Possibilité de définir une variante qui
[%step]
** Dépend du composant principal
** Ajoute des dépendances
** Peut aussi ajouter un binaire
* Qui en fait ne sont pas du tout optionelles ...
* Mais bien obligatoires pour certains cas d'utilisation

=== Applications du modèle des variantes

* Test fixtures,
* dépendances "optionelles"
* Aggregation de résultats entre projets
* (Transformation d'artifacts)

=== Publication

* Que publie-t-on?
** Un composant
** Ses variantes
** Ses meta données
* Où le publie-t-on?
** Dans un repository Maven
** Dans un repository Ivy

[background-color="#02303a"]
=== Démo
image::gradle/bg-8.png[background, size=cover]

=== Que publier?

* Le composant, `java` la plus part du temps
* Viser de modifier le composant plutôt que la publicationn
** Un artifact additionel?
** Définissez une variants

=== Méta données

* Pas possible de manipuler les GMM avec un API
* Toute mutation de POM avec `withXml` va entrainer des différences
* Comme pour les artifacts, modifier le composant!